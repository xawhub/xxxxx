if (typeof(SiebelAppFacade.TMOContactViewPM) === "undefined") {
  SiebelJS.Namespace("SiebelAppFacade.TMOContactViewPM");

  define("siebel/custom/TMOContactViewPM", ["siebel/viewpm"], function () {

    SiebelAppFacade.TMOContactViewPM = (function () {

      function TMOContactViewPM(pm) {
        SiebelAppFacade.TMOContactViewPM.superclass.constructor.apply(this, arguments);
      }

      SiebelJS.Extend(TMOContactViewPM, SiebelAppFacade.ViewPM);

      TMOContactViewPM.prototype.Init = function () {
        SiebelAppFacade.TMOContactViewPM.superclass.Init.apply(this, arguments);
        this.SetProperty("ShowVBC", false);

        var view = this.Get("GetView");
        var contactAppletPM = view.GetAppletMap()["TMO Contact Applet"].GetPModel();

        var self = this;
        contactAppletPM.AttachEventHandler("ShowSelection", function () {
          self.UpdateToggleState();
          self.ExecuteMethod("Refresh");
        });

        // inicjalizacja
        this.UpdateToggleState();
      };

      TMOContactViewPM.prototype.UpdateToggleState = function () {
        try {
          var view = this.Get("GetView");
          var contactPM = view.GetAppletMap()["TMO Contact Applet"].GetPModel();
          var val = contactPM.ExecuteMethod("GetFieldValue", "TMO Profile Id");
          this.SetProperty("ShowVBC", !!val && val !== "");
        } catch (e) {
          console.warn("UpdateToggleState error:", e);
        }
      };

      return TMOContactViewPM;
    })();

    return "SiebelAppFacade.TMOContactViewPM";
  });
}


if (typeof(SiebelAppFacade.TMOContactViewPR) === "undefined") {
  SiebelJS.Namespace("SiebelAppFacade.TMOContactViewPR");

  define("siebel/custom/TMOContactViewPR", ["siebel/phyrenderer"], function () {

    SiebelAppFacade.TMOContactViewPR = (function () {

      function TMOContactViewPR(pm) {
        SiebelAppFacade.TMOContactViewPR.superclass.constructor.apply(this, arguments);
      }

      SiebelJS.Extend(TMOContactViewPR, SiebelAppFacade.PhysicalRenderer);

      TMOContactViewPR.prototype.BindData = function () {
        SiebelAppFacade.TMOContactViewPR.superclass.BindData.apply(this, arguments);
        this.ToggleBillingProfiles();
      };

      TMOContactViewPR.prototype.BindEvents = function () {
        SiebelAppFacade.TMOContactViewPR.superclass.BindEvents.apply(this, arguments);

        var self = this;
        var pm = this.GetPM();

        pm.AttachEventHandler("Refresh", function () {
          self.ToggleBillingProfiles();
        });
      };

      TMOContactViewPR.prototype.ToggleBillingProfiles = function () {
        var pm = this.GetPM();
        var view = pm.Get("GetView");

        var showVBC = pm.Get("ShowVBC");
        var vbcApplet = view.GetAppletMap()["TMO Billing Profiles VBC Applet"];
        var bcApplet  = view.GetAppletMap()["TMO Billing Profiles BC Applet"];

        if (showVBC) {
          SiebelApp.S_App.ShowApplet(vbcApplet.GetName(), true);
          SiebelApp.S_App.ShowApplet(bcApplet.GetName(), false);
        } else {
          SiebelApp.S_App.ShowApplet(vbcApplet.GetName(), false);
          SiebelApp.S_App.ShowApplet(bcApplet.GetName(), true);
        }
      };

      return TMOContactViewPR;
    })();

    return "SiebelAppFacade.TMOContactViewPR";
  });
}
