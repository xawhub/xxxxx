if (typeof(SiebelAppFacade.ContactListAppletPM) === "undefined") {

    SiebelJS.Namespace("SiebelAppFacade.ContactListAppletPM");

    define("siebel/custom/ContactListAppletPM", ["siebel/pmodel"],
        function (PM) {

            SiebelAppFacade.ContactListAppletPM = (function () {

                function CustomPM() {
                    PM.call(this);
                }
                SiebelJS.Extend(CustomPM, PM);

                CustomPM.prototype.Init = function () {
                    PM.prototype.Init.apply(this, arguments);

                    var bc = this.Get("GetBusComp");
                    var self = this;

                    // event przy KAÅ»DEJ zmianie zaznaczonego rekordu w list applet
                    bc.AttachNotificationHandler(
                        "SelectionChange",
                        function () {
                            var profileId = bc.GetFieldValue("Profile Id");

                            SiebelApp.EventManager.fireEvent(
                                "BP_PROFILE_VISIBILITY",
                                { profileId: profileId }
                            );
                        }
                    );
                };

                return CustomPM;
            }());

            return "SiebelAppFacade.ContactListAppletPM";
        });
}

if (typeof(SiebelAppFacade.BPAccessPR) === "undefined") {

    SiebelJS.Namespace("SiebelAppFacade.BPAccessPR");

    define("siebel/custom/BPAccess_PR", ["siebel/phyrenderer"],
        function (PR) {

            SiebelAppFacade.BPAccessPR = (function () {

                function CustomPR() {
                    PR.call(this);
                    this._enabled = false;
                }
                SiebelJS.Extend(CustomPR, PR);

                CustomPR.prototype.Init = function () {
                    PR.prototype.Init.apply(this, arguments);

                    var self = this;

                    SiebelApp.EventManager.addListner(
                        "BP_PROFILE_VISIBILITY",
                        function (args) {
                            self._enabled = (args.profileId === "");
                            self.toggle();
                        }
                    );
                };

                CustomPR.prototype.toggle = function () {
                    var div = $("#" + this.GetPM().Get("GetFullId"));

                    if (this._enabled) {
                        div.show();
                        this.GetPM().ExecuteMethod("RefreshData"); // BC query
                    } else {
                        div.hide();
                    }
                };

                CustomPR.prototype.ShowUI = function () {
                    if (!this._enabled) return;
                    PR.prototype.ShowUI.apply(this, arguments);
                };

                CustomPR.prototype.BindData = function () {
                    if (!this._enabled) return;
                    PR.prototype.BindData.apply(this, arguments);
                };

                CustomPR.prototype.BindEvents = function () {
                    if (!this._enabled) return;
                    PR.prototype.BindEvents.apply(this, arguments);
                };

                return CustomPR;
            }());

            return "SiebelAppFacade.BPAccessPR";
        });
}

if (typeof(SiebelAppFacade.VBCBPAccessPR) === "undefined") {

    SiebelJS.Namespace("SiebelAppFacade.VBCBPAccessPR");

    define("siebel/custom/VBCBPAccess_PR", ["siebel/phyrenderer"],
        function (PR) {

            SiebelAppFacade.VBCBPAccessPR = (function () {

                function CustomPR() {
                    PR.call(this);
                    this._enabled = false;
                }
                SiebelJS.Extend(CustomPR, PR);

                CustomPR.prototype.Init = function () {
                    PR.prototype.Init.apply(this, arguments);

                    var self = this;

                    SiebelApp.EventManager.addListner(
                        "BP_PROFILE_VISIBILITY",
                        function (args) {
                            self._enabled = (args.profileId !== "");
                            self.toggle();
                        }
                    );
                };

                CustomPR.prototype.toggle = function () {
                    var div = $("#" + this.GetPM().Get("GetFullId"));

                    if (this._enabled) {
                        div.show();
                        this.GetPM().ExecuteMethod("RefreshData"); // VBC Query tylko teraz
                    } else {
                        div.hide();
                    }
                };

                CustomPR.prototype.ShowUI = function () {
                    if (!this._enabled) return;
                    PR.prototype.ShowUI.apply(this, arguments);
                };

                CustomPR.prototype.BindData = function () {
                    if (!this._enabled) return;
                    PR.prototype.BindData.apply(this, arguments);
                };

                CustomPR.prototype.BindEvents = function () {
                    if (!this._enabled) return;
                    PR.prototype.BindEvents.apply(this, arguments);
                };

                return CustomPR;
            }());

            return "SiebelAppFacade.VBCBPAccessPR";
        });
}
